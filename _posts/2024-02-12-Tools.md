---
title: Tools for Active Directory  
author: Droix3d
date: 2024-02-12
categories: [Active Directory Attack]
tags: [AD, Active Directory]
pin: false
image:
  path:
  alt: Active Directory
---

Antes de comenzar  con las tipos de explotación, técnicas & metodologías que uso a la hora de tratar de comprometer un Domain Controller es importante revisar la mayoría de herramientas que se usaran o las mas comunes que se emplean  

| Tools                                                                                                                                                       | Descripción                                                                                                                                                                                                                                                                   |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [PowerView](https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1) / [SharpView](https://github.com/dmchell/SharpView)               | Se ocupa en Powershell y en un puerto .NET, puede ayudarnos a recopilar gran parte de los datos que recopila Bloodhound y es excelente para verificar que acceso adicional podemos tener con un nuevo conjunto de credenciales, apuntar a usuarios o computadoras especificas o por ejemplo ver que usuarios pueden ser Kerberoasting o ASREPRoasting |
| [BloodHound](https://github.com/BloodHoundAD/BloodHound)                                                                                                  | Nos ayuda a trazar visualmente las relaciones de AD y ayuda a planificar rutas de ataque de algún otro modo, se utiliza con sharphound para que pueda procesar estos datos e importarla en la base de datos Neo4j de Bloodhound para analizar gráficamente los datos                                                 |
| [SharpHound](https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors)                                                                           | Está hecho en C# y recopila datos del AD sobre diversos objetos, la herramienta produce archivos JSON para que se puedan introducir a la base de datos de Bloodhound                                                                                                                |
| [BloodHound.py](https://github.com/fox-it/BloodHound.py)                                                                                                  | Es una herramienta que viene en el kit de Impacket, se puede utilizar desde un host de ataque que no esté unido a un dominio, su output se incorpora a la GUI de Bloodhound para el análisis                                                                                            |
| [Kerbrute](https://github.com/ropnop/kerbrute)                                                                                                            | Una herramienta escrita en GO y utiliza la autenticación previa de Kerberos para enumerar cuentas de AD, usuarios válidos por Kerberos, contraseñas, etc.                                                                                                                         |
| [Impacket toolkit](https://github.com/SecureAuthCorp/impacket)                                                                                            | Colección de herramientas escritas en Python para interactuar con protocolos de red y contiene herramientas para enumerar y explotar el AD                                                                                                                                    |
| [Responder](https://github.com/lgandx/Responder)                                                                                                          | Herramienta que sirve para envenenar protocolos LLMNR, NBT-NS y MDNS                                                                                                                                                                                                          |
| [CrackMapExec (CME)](https://github.com/byt3bl33d3r/CrackMapExec)                                                                                         | La famosa navaja suiza, herramienta de ataque y post-explotación que puede ayudarnos a la enumeración y realización de ataques con los datos que vayamos recopilando, abusa sobre todo de protocolos SMB, WMI, WINRM, LDAP y MSSQL                                      |
| [Rubeus](https://github.com/GhostPack/Rubeus)                                                                                                             | Es una herramienta creada en C# y su principal función es abusar de Kerberos                                                                                                                                                                                                  |
| [GetUserSPNs.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetUserSPNs.py)                                                          | Sirve para encontrar nombres principales de servicio vinculados a algún usuario (Service Principal Name)                                                                                                                                                                    |
| [enum4linux](https://github.com/CiscoCXSecurity/enum4linux)                                                                                               | Sirve para enumerar información de sistemas Windows y Samba                                                                                                                                                                                                                    |
| [ldapsearch](https://linux.die.net/man/1/ldapsearch)                                                                                                      | Incorpora una interfaz para enumerar todo un dominio a través de LDAP                                                                                                                                                                                                            |
| [smbmap](https://github.com/ShawnDEvans/smbmap)                                                                                                           | Ayuda a enumerar recursos del sistema por SMB                                                                                                                                                                                                                                   |
| [psexec.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py)                                                                    | Podemos acceder de manera remota a un sistema si tenemos los permisos de autenticación a nivel de red                                                                                                                                                                                                                                           |
| [wmiexec.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py)                                                                  | Nos permite acceder igual de manera remota a través de WMI                                                                                                                                                                                                                      |
| [smbserver.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py)                                                              | Ejecución simple de un servidor SMB, podemos compartir dicho servidor SMB a través de nuestra red para transferir archivos o agarrar autenticaciones                                                                                                                                                                                        |
| [Mimikatz](https://github.com/ParrotSec/mimikatz)                                                                                                         | Realiza muchas funciones como PASS-THE-HASH, extracción de contraseñas en texto claro y extracción de tickets en Kerberos de la memoria                                                                                                                                                                                                       |
| [secretsdump.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py)                                                          | Herramientas para hacer volcado de la SAM y LSA de un host                                                                                                                                                                                                                      |
| [evil-winrm](https://github.com/Hackplayers/evil-winrm)                                                                                                   | Nos proporciona una shell interactiva a través del protocolo WinRM (puerto 5985)                                                                                                                                                                                               |
| [mssqlclient.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py)                                                          | Podemos interactuar de manera remota a través de una base de datos MSSQL                                                                                                                                                                                                      |
| [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py)                                                            | Podemos hacer ataques de relay por SMB                                                                                                                                                                                                                                         |
| [GetNPUsers.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py)                                                            | Se utiliza para realizar el ataque ASREPRoasting para enumerar y obtener hashes AS-REP para usuarios con la configuración "No requiere autenticación previa de Kerberos". Se pueden utilizar estos hashes para crackear de forma offline                                                                                            |
| [ticketer.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/ticketer.py)                                                                | Nos permite personalizar nuestros tickets TGT/TGS para crear un GoldenTicket Attack                                                                                                                                                                                            |


|**Recurso**|**Ejemplos**|
|---|---|
|`ASN / IP registrars`|[IANA](https://www.iana.org/) , [arin](https://www.arin.net/) para realizar búsquedas en América, [RIPE](https://www.ripe.net/) para realizar búsquedas en Europa, [BGP Toolkit](https://bgp.he.net/)|
|`Domain Registrars & DNS`|[Domaintools](https://www.domaintools.com/) , [PTRArchive](http://ptrarchive.com/) , [ICANN](https://lookup.icann.org/lookup) , solicitudes manuales de registros DNS contra el dominio en cuestión o contra servidores DNS conocidos, como `8.8.8.8`.|
|`Social Media`|Buscar en Linkedin, Twitter, Facebook, los principales sitios de redes sociales de su región, artículos de noticias y cualquier información relevante que pueda encontrar sobre la organización.|
|`Public-Facing Company Websites`|A menudo, el sitio web público de una corporación tendrá información relevante incorporada. Los artículos de noticias, los documentos incrustados y las páginas "Acerca de nosotros" y "Contáctenos" también pueden ser minas de oro.|
|`Cloud & Dev Storage Spaces`|[GitHub](https://github.com/) , [depósitos de AWS S3 y contenedores de almacenamiento de Azure Blog](https://grayhatwarfare.com/) , [búsquedas en Google utilizando "Dorks"](https://www.exploit-db.com/google-hacking-database)|
|`Breach Data Sources`|[HaveIBeenPwned](https://haveibeenpwned.com/) para determinar si alguna cuenta de correo electrónico corporativa aparece en los datos públicos de violación, [Dehashed](https://www.dehashed.com/) para buscar correos electrónicos corporativos con contraseñas de texto sin cifrar o hashes que podamos intentar descifrar sin conexión. Luego podemos probar estas contraseñas con cualquier portal de inicio de sesión expuesto (Citrix, RDS, OWA, 0365, VPN, VMware Horizon, aplicaciones personalizadas, etc.) que puedan usar autenticación AD.|



